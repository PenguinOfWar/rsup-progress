{"version":3,"sources":["../src/index.ts","app.js"],"names":["progress","Progress","start","window"],"mappings":"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","file":"app.c328ef1a.map","sourceRoot":"..\\website","sourcesContent":["interface UserOptions {\r\n    maxWidth?: number | string,\r\n    height?: number | string,\r\n    duration?: number,\r\n    hideDuration?: number,\r\n    zIndex?: number | string,\r\n    className?: string | string[],\r\n    color?: string\r\n}\r\n\r\ninterface Options {\r\n    maxWidth: string,\r\n    height: string,\r\n    duration: number,\r\n    hideDuration: number,\r\n    zIndex: string,\r\n    className: string,\r\n    color: string\r\n}\r\n\r\nexport class Progress {\r\n    private _el: HTMLDivElement\r\n    private _opts!: Options\r\n    private _isProgress = false\r\n    private _isHiding = false\r\n    private _isScheduled = false\r\n    private _tickId: number | null = null\r\n    private _promises: Array<Promise<any>> = []\r\n\r\n    constructor (userOpts: UserOptions = {}) {\r\n        this._el = document.createElement('div')\r\n        this.setOptions(userOpts)\r\n    }\r\n\r\n    public setOptions (userOpts: UserOptions) {\r\n        assertProp(userOpts, 'maxWidth', ['number', 'string'])\r\n        assertProp(userOpts, 'height', ['number', 'string'])\r\n        assertProp(userOpts, 'duration', 'number')\r\n        assertProp(userOpts, 'hideDuration', 'number')\r\n        assertProp(userOpts, 'zIndex', ['number', 'string'])\r\n        assertProp(userOpts, 'color', 'string')\r\n\r\n        if (userOpts.className && (typeof userOpts.className !== 'string' && !Array.isArray(userOpts.className))) {\r\n            throw new TypeError(`[rsup-progress] Expected \\`className\\` to be of type \"string, string[]\".`)\r\n        }\r\n\r\n        const opts = this._opts = normalizeOptions(userOpts)\r\n\r\n        this._el.className = opts.className\r\n        this._css({\r\n            position: 'fixed',\r\n            zIndex: opts.zIndex,\r\n            top: '0',\r\n            left: '0',\r\n            height: opts.height,\r\n            background: opts.color\r\n        })\r\n    }\r\n\r\n    private _css (style: Partial<CSSStyleDeclaration>) {\r\n        Object.assign(this._el.style, style)\r\n    }\r\n\r\n    get isProgress () {\r\n        return this._isProgress\r\n    }\r\n\r\n    public start () {\r\n        if (this._isProgress) {\r\n            if (this._isHiding) this._isScheduled = true\r\n            return\r\n        }\r\n\r\n        this._isProgress = true\r\n\r\n        const transition = `width ${this._opts.duration}ms cubic-bezier(0,1,0,1)`\r\n        this._css({\r\n            width: '0',\r\n            opacity: '1',\r\n            transition,\r\n            webkitTransition: transition\r\n        })\r\n\r\n        document.body.appendChild(this._el)\r\n\r\n        this._nextTick(() => {\r\n            this._nextTick(() => {\r\n                this._css({ width: this._opts.maxWidth })\r\n                this._tickId = null\r\n            })\r\n        })\r\n    }\r\n\r\n    private _nextTick (fn: () => void) {\r\n        this._tickId = (requestAnimationFrame || setTimeout)(fn)\r\n    }\r\n\r\n    private _clearTick () {\r\n        if (this._tickId) {\r\n            (cancelAnimationFrame || clearTimeout)(this._tickId)\r\n            this._tickId = null\r\n        }\r\n    }\r\n\r\n    public end (immediately = false) {\r\n        this._clearPromise()\r\n\r\n        if (this._isScheduled) this._isScheduled = false\r\n        if (!this._isProgress || this._isHiding) return\r\n\r\n        if (this._tickId || immediately) {\r\n            this._isProgress = false\r\n            document.body.removeChild(this._el)\r\n            if (this._tickId) this._clearTick()\r\n            return\r\n        }\r\n\r\n        this._isHiding = true\r\n\r\n        const PERSIST_TIME = 150\r\n        const transition = `width 50ms, opacity ${this._opts.hideDuration}ms ${PERSIST_TIME}ms`\r\n\r\n        this._css({\r\n            width: '100%',\r\n            opacity: '0',\r\n            transition,\r\n            webkitTransition: transition\r\n        })\r\n\r\n        setTimeout(() => {\r\n            this._isHiding = false\r\n            this._isProgress = false\r\n            document.body.removeChild(this._el)\r\n\r\n            if (this._isScheduled) {\r\n                this._isScheduled = false\r\n                this.start()\r\n            }\r\n        }, this._opts.hideDuration + PERSIST_TIME)\r\n    }\r\n\r\n    public promise<T> (promise: Promise<T>, delay = 0) {\r\n        this._promises.push(promise)\r\n        let started = false\r\n\r\n        if (delay > 0) {\r\n            setTimeout(() => {\r\n                if (!this._isProgress && this._promises.indexOf(promise) > -1) {\r\n                    started = true\r\n                    this.start()\r\n                }\r\n            }, delay)\r\n        } else {\r\n            started = true\r\n            this.start()\r\n        }\r\n\r\n        const onFinally = () => {\r\n            this._clearPromise(promise)\r\n            if (started && this._promises.length === 0 && this._isProgress) this.end()\r\n        }\r\n\r\n        return promise.then(\r\n            val => (onFinally(), val),\r\n            err => (onFinally(), Promise.reject(err))\r\n        )\r\n    }\r\n\r\n    private _clearPromise (promise ?: Promise<any>) {\r\n        this._promises = promise ? this._promises.filter(p => p !== promise) : []\r\n    }\r\n}\r\n\r\nexport default Progress\r\n\r\nfunction normalizeOptions (opts: UserOptions): Options {\r\n    opts = {\r\n        maxWidth: '99.7%',\r\n        height: '4px',\r\n        duration: 90000,\r\n        hideDuration: 400,\r\n        zIndex: '9999',\r\n        color: '#ff1a59',\r\n        className: '',\r\n        ...opts\r\n    }\r\n\r\n    if (typeof opts.maxWidth === 'number') opts.maxWidth = opts.maxWidth + 'px'\r\n    if (typeof opts.height === 'number') opts.height = opts.height + 'px'\r\n    if (typeof opts.zIndex === 'number') opts.zIndex = String(opts.zIndex)\r\n    if (Array.isArray(opts.className)) opts.className = opts.className.join(' ')\r\n\r\n    return opts as Options\r\n}\r\n\r\nfunction assertProp (obj: any, prop: string, expected: string | string[]) {\r\n    const type = typeof obj[prop]\r\n    if (type === 'undefined') return\r\n    if (typeof expected === 'string') expected = [expected]\r\n    if (expected.indexOf(type) > -1) return\r\n\r\n    throw new TypeError(`[rsup-progress] Expected \\`${prop}\\` to be of type \"${expected.join(', ')}\", but \"${type}\".`)\r\n}\r\n","import {Progress} from '../src/'\r\n\r\nconst progress = new Progress()\r\n\r\nprogress.start()\r\n\r\nwindow.progress = progress\r\n\r\n"]}