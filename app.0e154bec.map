{"version":3,"sources":["../node_modules/@byungi/promise-helpers/index.js","../node_modules/@byungi/p-delay/index.js","../src/index.ts","app.ts"],"names":["assert","name","expected","val","type","TypeError","isThenable","promise","then","isCancellable","cancel","Object","defineProperty","exports","value","promise_helpers_1","require","pDelay","ms","resolve","clearable","p","Promise","_resolve","timer","setTimeout","clear","clearTimeout","default"],"mappings":"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","file":"app.0e154bec.map","sourceRoot":"..\\website","sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction assert(name, expected, val) {\r\n    const type = typeof val;\r\n    if (type !== expected) {\r\n        throw new TypeError(`Expected \"${name}\" to be of type ${expected}, but \"${type}\".`);\r\n    }\r\n}\r\nexports.assert = assert;\r\nfunction isThenable(promise) {\r\n    return promise && typeof promise.then === 'function';\r\n}\r\nexports.isThenable = isThenable;\r\nfunction isCancellable(promise) {\r\n    return isThenable(promise) && typeof promise.cancel === 'function';\r\n}\r\nexports.isCancellable = isCancellable;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst promise_helpers_1 = require(\"@byungi/promise-helpers\");\r\nexports.pDelay = (ms, { clearable = false } = {}) => {\r\n    promise_helpers_1.assert('ms', 'number', ms);\r\n    let resolve;\r\n    const p = new Promise((_resolve) => resolve = _resolve);\r\n    let timer = setTimeout(resolve, ms);\r\n    if (clearable) {\r\n        p.clear = () => {\r\n            if (!timer)\r\n                return;\r\n            clearTimeout(timer);\r\n            timer = null;\r\n            resolve();\r\n        };\r\n    }\r\n    return p;\r\n};\r\nexports.default = exports.pDelay;\r\n","interface UserOptions {\r\n    maxWidth?: number | string\r\n    height?: number | string\r\n    duration?: number\r\n    hideDuration?: number\r\n    zIndex?: number | string\r\n    className?: string\r\n    color?: string\r\n    timing?: string\r\n}\r\n\r\ninterface Options {\r\n    maxWidth: string\r\n    height: string\r\n    duration: number\r\n    hideDuration: number\r\n    zIndex: string\r\n    className: string\r\n    color: string\r\n    timing: string\r\n}\r\n\r\nexport class Progress {\r\n    private _el: HTMLDivElement\r\n    private _opts!: Options\r\n    private _isProgress = false\r\n    private _isHiding = false\r\n    private _isScheduled = false\r\n    private _tickId: number | null = null\r\n    private _promises: Array<Promise<any>> = []\r\n\r\n    constructor (userOpts: UserOptions = {}) {\r\n        this._el = document.createElement('div')\r\n        this.setOptions(userOpts)\r\n    }\r\n\r\n    public setOptions (userOpts: UserOptions) {\r\n        assertProp(userOpts, 'maxWidth', ['number', 'string'])\r\n        assertProp(userOpts, 'height', ['number', 'string'])\r\n        assertProp(userOpts, 'duration', 'number')\r\n        assertProp(userOpts, 'hideDuration', 'number')\r\n        assertProp(userOpts, 'zIndex', ['number', 'string'])\r\n        assertProp(userOpts, 'className', 'string')\r\n        assertProp(userOpts, 'color', 'string')\r\n\r\n        const opts = this._opts = normalizeOptions(userOpts)\r\n\r\n        this._el.className = opts.className\r\n        this._css({\r\n            position: 'fixed',\r\n            zIndex: opts.zIndex,\r\n            top: '0',\r\n            left: '0',\r\n            height: opts.height,\r\n            background: opts.color\r\n        })\r\n    }\r\n\r\n    private _css (style: Partial<CSSStyleDeclaration>) {\r\n        Object.assign(this._el.style, style)\r\n    }\r\n\r\n    get isProgress () {\r\n        return this._isProgress\r\n    }\r\n\r\n    public start () {\r\n        if (this._isProgress) {\r\n            if (this._isHiding) this._isScheduled = true\r\n            return\r\n        }\r\n\r\n        this._isProgress = true\r\n\r\n        const transition = `width ${this._opts.duration}ms ${this._opts.timing}`\r\n        this._css({\r\n            width: '0',\r\n            opacity: '1',\r\n            transition,\r\n            webkitTransition: transition\r\n        })\r\n\r\n        document.body.appendChild(this._el)\r\n\r\n        this._nextTick(() => {\r\n            this._nextTick(() => {\r\n                this._css({ width: this._opts.maxWidth })\r\n                this._tickId = null\r\n            })\r\n        })\r\n    }\r\n\r\n    private _nextTick (fn: () => void) {\r\n        this._tickId = (requestAnimationFrame || setTimeout)(fn)\r\n    }\r\n\r\n    private _clearTick () {\r\n        if (this._tickId) {\r\n            (cancelAnimationFrame || clearTimeout)(this._tickId)\r\n            this._tickId = null\r\n        }\r\n    }\r\n\r\n    public end (immediately = false) {\r\n        this._clearPromise()\r\n\r\n        if (this._isScheduled) this._isScheduled = false\r\n        if (!this._isProgress || this._isHiding) return\r\n\r\n        if (this._tickId || immediately) {\r\n            this._isProgress = false\r\n            document.body.removeChild(this._el)\r\n            if (this._tickId) this._clearTick()\r\n            return\r\n        }\r\n\r\n        this._isHiding = true\r\n\r\n        const PERSIST_TIME = 150\r\n        const transition = `width 50ms, opacity ${this._opts.hideDuration}ms ${PERSIST_TIME}ms`\r\n\r\n        this._css({\r\n            width: '100%',\r\n            opacity: '0',\r\n            transition,\r\n            webkitTransition: transition\r\n        })\r\n\r\n        setTimeout(() => {\r\n            this._isHiding = false\r\n            this._isProgress = false\r\n            document.body.removeChild(this._el)\r\n\r\n            if (this._isScheduled) {\r\n                this._isScheduled = false\r\n                this.start()\r\n            }\r\n        }, this._opts.hideDuration + PERSIST_TIME)\r\n    }\r\n\r\n    public promise<T> (promise: Promise<T>, delay = 0) {\r\n        this._promises.push(promise)\r\n        let started = false\r\n\r\n        if (delay > 0) {\r\n            setTimeout(() => {\r\n                if (this._promises.indexOf(promise) > -1) {\r\n                    started = true\r\n                    this.start()\r\n                }\r\n            }, delay)\r\n        } else {\r\n            started = true\r\n            this.start()\r\n        }\r\n\r\n        const onFinally = () => {\r\n            this._clearPromise(promise)\r\n            if (started && this._promises.length === 0 && this._isProgress) this.end()\r\n        }\r\n\r\n        return promise.then(\r\n            val => (onFinally(), val),\r\n            err => (onFinally(), Promise.reject(err))\r\n        )\r\n    }\r\n\r\n    private _clearPromise (promise ?: Promise<any>) {\r\n        this._promises = promise ? this._promises.filter(p => p !== promise) : []\r\n    }\r\n}\r\n\r\nexport default Progress\r\n\r\nfunction normalizeOptions (opts: UserOptions): Options {\r\n    opts = {\r\n        maxWidth: '99.8%',\r\n        height: '4px',\r\n        duration: 60000,\r\n        hideDuration: 400,\r\n        zIndex: '9999',\r\n        color: '#ff1a59',\r\n        className: '',\r\n        timing: 'cubic-bezier(0,1,0,1)',\r\n        ...opts\r\n    }\r\n\r\n    if (typeof opts.maxWidth === 'number') opts.maxWidth = opts.maxWidth + 'px'\r\n    if (typeof opts.height === 'number') opts.height = opts.height + 'px'\r\n    if (typeof opts.zIndex === 'number') opts.zIndex = String(opts.zIndex)\r\n\r\n    return opts as Options\r\n}\r\n\r\nfunction assertProp (obj: any, prop: string, expected: string | string[]) {\r\n    const type = typeof obj[prop]\r\n    if (type === 'undefined') return\r\n    if (typeof expected === 'string') expected = [expected]\r\n    if (expected.indexOf(type) > -1) return\r\n\r\n    throw new TypeError(`[rsup-progress] Expected \\`${prop}\\` to be of type ${expected.join(', ')}, but \"${type}\".`)\r\n}\r\n","import { pDelay } from '@byungi/p-delay'\r\nimport { Progress } from '../src/'\r\n\r\n(window as any).progress = new Progress({ height: 5 });\r\n(window as any).delay = pDelay\r\n"]}